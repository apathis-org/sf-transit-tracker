<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SF Transit Tracker - Route-Aware</title>
    
    <!-- External Libraries -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
    
    <!-- Default theme with exact original styles -->
    <link rel="stylesheet" href="/static/themes/default/default-theme.css">
</head>
<body>
    <div id="map"></div>

    <div class="panel status-panel">
        <div class="status-indicator" id="status">
            <div class="status-dot connecting"></div>
            Connecting...
        </div>
        <div style="font-size: 10px; margin-top: 4px; opacity: 0.8;" id="update-time">
            Last update: --:--
        </div>
        <div style="font-size: 10px; margin-top: 4px; opacity: 0.8;" id="route-status">
            Routes: Loading...
        </div>
    </div>

    <!-- Mobile Filter Toggle Button -->
    <button class="filter-toggle" id="filter-toggle" aria-label="Toggle Filters">
        <span class="hamburger"></span>
        <span class="hamburger"></span>
        <span class="hamburger"></span>
    </button>

    <div class="panel filter-panel" id="filter-panel">
        <div class="filter-header">
            <h3 style="color: #4facfe; margin-bottom: 10px;">üéõÔ∏è Filters</h3>
            <button class="filter-close" id="filter-close" aria-label="Close Filters">‚úï</button>
        </div>

        <div class="filter-group">
            <h4>SFMTA (San Francisco)</h4>
            <div class="filter-item">
                <input type="checkbox" id="filter-muni-bus" checked>
                <span class="filter-name">Muni Buses</span>
                <span class="filter-count" id="count-muni-bus">0</span>
            </div>
            <div class="filter-item">
                <input type="checkbox" id="filter-light-rail" checked>
                <span class="filter-name">Light Rail</span>
                <span class="filter-count" id="count-light-rail">0</span>
            </div>
            <div class="filter-item">
                <input type="checkbox" id="filter-cable-car">
                <span class="filter-name">Cable Cars</span>
                <span class="filter-count" id="count-cable-car">0</span>
            </div>
        </div>

        <div class="filter-group">
            <h4>BART</h4>
            <div class="filter-item">
                <input type="checkbox" id="filter-bart-train">
                <span class="filter-name">BART Trains</span>
                <span class="filter-count" id="count-bart-train">0</span>
            </div>
        </div>

        <div class="filter-group">
            <h4>Golden Gate</h4>
            <div class="filter-item">
                <input type="checkbox" id="filter-gg-bus">
                <span class="filter-name">GG Buses</span>
                <span class="filter-count" id="count-gg-bus">0</span>
            </div>
            <div class="filter-item">
                <input type="checkbox" id="filter-ferry">
                <span class="filter-name">Ferries</span>
                <span class="filter-count" id="count-ferry">0</span>
            </div>
        </div>

        <div class="filter-group">
            <h4>AC Transit</h4>
            <div class="filter-item">
                <input type="checkbox" id="filter-ac-bus">
                <span class="filter-name">AC Buses</span>
                <span class="filter-count" id="count-ac-bus">0</span>
            </div>
        </div>
    </div>

    <div class="panel info-panel">
        <h3>üöå Transit Tracker</h3>
        <div class="stats">
            <div class="stat-item">
                <div class="stat-value" id="total-vehicles">0</div>
                <div class="stat-label">Vehicles</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="total-agencies">0</div>
                <div class="stat-label">Agencies</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="route-aware-count">0</div>
                <div class="stat-label">Route-Aware</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="routes-loaded">0</div>
                <div class="stat-label">Routes Loaded</div>
            </div>
        </div>
    </div>

    <!-- External Libraries -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    
    <!-- Modular JavaScript -->
    <script src="/static/routeManager.js"></script>
    <script src="/static/js/TransitTracker.js"></script>
    
    <!-- Mobile Filter Toggle -->
    <script>
        // Mobile filter toggle functionality
        document.addEventListener('DOMContentLoaded', () => {
            const filterToggle = document.getElementById('filter-toggle');
            const filterPanel = document.getElementById('filter-panel');
            const filterClose = document.getElementById('filter-close');
            
            function toggleFilters() {
                filterPanel.classList.toggle('show');
                filterToggle.classList.toggle('active');
            }
            
            function closeFilters() {
                filterPanel.classList.remove('show');
                filterToggle.classList.remove('active');
            }
            
            // Event listeners
            if (filterToggle) {
                filterToggle.addEventListener('click', toggleFilters);
            }
            
            if (filterClose) {
                filterClose.addEventListener('click', closeFilters);
            }
            
            // Close filters when clicking outside on mobile
            document.addEventListener('click', (e) => {
                if (window.innerWidth <= 768 && 
                    filterPanel.classList.contains('show') &&
                    !filterPanel.contains(e.target) && 
                    !filterToggle.contains(e.target)) {
                    closeFilters();
                }
            });
            
            // Close filters on escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && filterPanel.classList.contains('show')) {
                    closeFilters();
                }
            });
        });
    </script>

    <!-- Application Initialization -->
    <script>
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            window.tracker = new TransitTracker();
        });
    </script>
</body>
</html>