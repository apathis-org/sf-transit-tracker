┌──────────────────────────────────────────────────────────────┐
│                      User Browser                             │
│               JavaScript + Leaflet.js                         │
└────────────────────────┬─────────────────────────────────────┘
                         │
                         │ Socket.IO Client
                         │ (HTTP Long Polling)
                         │
                         ↓
┌──────────────────────────────────────────────────────────────┐
│                  Flask Application                            │
│                                                               │
│  ┌─────────────────────────────────────────────┐            │
│  │      Flask-SocketIO Server                  │            │
│  │   (HTTP Long Polling, NOT WebSockets)      │            │
│  └─────────────────┬───────────────────────────┘            │
│                    │                                          │
│                    │ Connection Events                        │
│                    ↓                                          │
│  ┌─────────────────────────────────────────────┐            │
│  │      Background Updater Thread              │            │
│  │        (30-second cycles)                   │            │
│  └─────────────────┬───────────────────────────┘            │
│                    │                                          │
│                    │ Fetch Data                               │
│                    ↓                                          │
│  ┌─────────────────────────────────────────────┐            │
│  │       Transit Data Fetcher                  │            │
│  │    (Multi-API Integration Layer)            │            │
│  └─────────────────┬───────────────────────────┘            │
│                    │                                          │
└────────────────────┼──────────────────────────────────────────┘
                     │
         ┌───────────┼───────────┐
         │           │           │
         ↓           ↓           ↓
    ┌────────┐  ┌────────┐  ┌──────────┐
    │511.org │  │ BART   │  │Transit   │
    │GTFS-RT │  │  API   │  │  .land   │
    │(26 Ag.)│  │ (XML)  │  │ (GTFS)   │
    └────────┘  └────────┘  └──────────┘
         │           │           │
         └───────────┴───────────┘
                     │
              Data Normalization
                     │
                     ↓
         ┌─────────────────────┐
         │  Vehicle Objects    │
         │  (Unified Format)   │
         └─────────┬───────────┘
                   │
            Broadcast via
         Socket.IO (bulk_update)
                   │
                   ↓
            Back to User Browser
